# Google Sheets Integration Setup for Capacity Model

This guide will help you set up the Google Sheets integration for your Capacity Model in Cursor.

## üìã Prerequisites

- Google account with access to the spreadsheet
- Python 3.7+ installed
- Google Cloud Console access

## üîß Step 1: Google Cloud Console Setup

### 1.1 Create a Google Cloud Project

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select an existing one
3. Enable the Google Sheets API:
   - Go to "APIs & Services" > "Library"
   - Search for "Google Sheets API"
   - Click "Enable"

### 1.2 Create Credentials

1. Go to "APIs & Services" > "Credentials"
2. Click "Create Credentials" > "OAuth 2.0 Client IDs"
3. Choose "Desktop application"
4. Download the credentials file and rename it to `credentials.json`
5. Place `credentials.json` in the project root directory

## üìä Step 2: Google Apps Script Setup

### 2.1 Add Apps Script to Your Spreadsheet

1. Open your Google Spreadsheet: [Sales data - 7.1.24 - 6.30.25](https://docs.google.com/spreadsheets/d/1fj4rwc3ZMNxBAlXvX-kMLIqcgPvXx79cwpCSH-7SmmU/edit?gid=0#gid=0)
2. Go to "Extensions" > "Apps Script"
3. Replace the default code with the contents of `google_sheets_integration/apps_script/capacity_model.gs`
4. Save the script with a name like "Capacity Model Script"

### 2.2 Deploy as Web App (Optional)

If you want to enable webhook functionality:

1. Click "Deploy" > "New deployment"
2. Choose "Web app"
3. Set access to "Anyone with the link"
4. Copy the Web App URL
5. Update the `webhook.url` in `config.json`

## üêç Step 3: Python Environment Setup

### 3.1 Install Dependencies

```bash
pip install -r requirements.txt
```

### 3.2 First Run Authentication

```bash
python google_sheets_integration/cursor_integration.py
```

This will:
- Open a browser window for Google authentication
- Create a `token.pickle` file for future use
- Test the connection to your spreadsheet

## üîÑ Step 4: Cursor Integration

### 4.1 Add to Cursor Settings

1. In Cursor, go to Settings > Integrations
2. Click "+ Add Data Source"
3. Select "Google Sheets"
4. Authenticate using your Google account
5. Select the spreadsheet: "Sales data - 7.1.24 - 6.30.25"

### 4.2 Configure Sheet Access

Ensure access is granted to:
- **Sheet1** (raw data)
- **Capacity Model** (generated by script)
- **Matrix** (criteria configuration)

## üìà Step 5: Using the Integration

### 5.1 Generate Capacity Model

The Apps Script will automatically:
1. Read data from Sheet1
2. Apply matrix criteria from the Matrix tab
3. Generate the Capacity Model tab with the format:

| Sales Rep First | Sales Rep Last | Sales ($) | Admin Count | Prod Spec Count | Sr. Prod Count | Team Lead Count | Intl Project Count |
|----------------|----------------|-----------|-------------|-----------------|----------------|-----------------|-------------------|

### 5.2 Manual Trigger

In the Google Sheet:
1. Look for the "Capacity Model" menu item
2. Click "Generate Capacity Model" to run the script manually
3. Click "Refresh Matrix Criteria" to update with new criteria

### 5.3 Python API Usage

```python
from google_sheets_integration.cursor_integration import GoogleSheetsIntegration

# Initialize
sheets = GoogleSheetsIntegration("1fj4rwc3ZMNxBAlXvX-kMLIqcgPvXx79cwpCSH-7SmmU")
sheets.authenticate()

# Get capacity model data
capacity_data = sheets.get_capacity_model_data()
print(capacity_data)

# Get insights
insights = sheets.get_capacity_insights()
print(insights)

# Export to CSV
sheets.export_capacity_model_to_csv()
```

## ‚öôÔ∏è Step 6: Matrix Configuration

### 6.1 Default Criteria

The Matrix tab will be created with default criteria:

| Role | Criteria |
|------|----------|
| Admin | admin,management,supervision |
| Production Specialist | production,assembly,manufacturing |
| Sr. Production Specialist | senior,lead,expert,advanced |
| Team Lead | team lead,supervisor,coordinator |

### 6.2 Customizing Criteria

1. Edit the Matrix tab in your Google Sheet
2. Add or modify role criteria as needed
3. Use comma-separated keywords for each role
4. The script will match project descriptions against these criteria

## üîó Step 7: Webhook Integration (Optional)

If you deployed the Apps Script as a web app:

1. Update `config.json` with your webhook URL
2. Set `webhook.enabled` to `true`
3. Use the Python API to trigger updates:

```python
sheets.trigger_capacity_model_generation("YOUR_WEBHOOK_URL")
```

## üìä Step 8: Data Analysis

### 8.1 Available Insights

The integration provides:
- Total sales and sales rep performance
- Project distribution by role type
- International project counts
- Capacity utilization percentages
- Top performer identification

### 8.2 Export Options

- CSV export with timestamp
- Real-time data access via API
- Automated insights generation

## üö® Troubleshooting

### Common Issues

1. **Authentication Error**: Delete `token.pickle` and re-authenticate
2. **Permission Denied**: Ensure the Google account has edit access to the spreadsheet
3. **Sheet Not Found**: Verify sheet names match exactly (case-sensitive)
4. **API Quota Exceeded**: Google Sheets API has daily limits

### Debug Mode

Enable debug logging by adding to your Python script:

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

## üìû Support

For issues or questions:
1. Check the Google Apps Script logs in the Apps Script editor
2. Verify API credentials and permissions
3. Test with a small dataset first

## üîÑ Ongoing Workflow

- Matrix tab updates automatically impact Capacity Model logic
- Cursor can query Capacity Model tab directly
- Supports automated insights and triggers
- Real-time data synchronization between Google Sheets and Cursor 